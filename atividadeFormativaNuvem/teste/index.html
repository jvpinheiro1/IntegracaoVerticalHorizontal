<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Sistema Integrado de Produção</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    section { margin-bottom: 30px; }
    input, button { margin: 5px; }
    pre { background: #f4f4f4; padding: 10px; }
  </style>
</head>
<body>
  <h1>Sistema Integrado de Produção</h1>

  <section>
    <h2>Produção - Criar Ordem</h2>
    <input type="text" id="modelo" placeholder="Modelo do veículo">
    <button onclick="criarOrdem()">Criar Ordem</button>
    <ul id="ordens"></ul>
  </section>

  <section>
    <h2>Produção - Adicionar Etapa</h2>
    <input type="number" id="etapa_ordem_id" placeholder="ID da Ordem">
    <input type="text" id="etapa_descricao" placeholder="Descrição da Etapa">
    <input type="text" id="etapa_status" placeholder="Status da Etapa">
    <button onclick="adicionarEtapa()">Adicionar Etapa</button>
  </section>

  <section>
    <h2>Qualidade - Registrar Inspeção</h2>
    <input type="text" id="ordem_id" placeholder="ID da Ordem">
    <input type="text" id="descricao_inspecao" placeholder="Descrição">
    <label><input type="checkbox" id="conforme"> Conforme</label>
    <button onclick="registrarInspecao()">Registrar</button>
    <ul id="inspecoes"></ul>
  </section>

  <section>
    <h2>Peças - Registrar Componente</h2>
    <input type="text" id="codigo_peca" placeholder="Código">
    <input type="text" id="descricao_peca" placeholder="Descrição">
    <input type="text" id="vin" placeholder="VIN do veículo">
    <button onclick="registrarPeca()">Registrar</button>
    <ul id="pecas"></ul>
  </section>

  <section>
    <h2>Dashboard Consolidado</h2>
    <button onclick="dashboard()">Atualizar Dashboard</button>
    <pre id="dashboard"></pre>
  </section>

  <script>
    async function criarOrdem() {
      const modelo = document.getElementById('modelo').value;
      await fetch('http://localhost:5001/ordens', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ modelo })
      });
      listarOrdens();
    }

    async function listarOrdens() {
      const resp = await fetch('http://localhost:5001/ordens');
      const dados = await resp.json();
      const ul = document.getElementById('ordens');
      ul.innerHTML = '';
      dados.forEach(o => {
        const li = document.createElement('li');
        li.innerHTML = `<strong>ID:</strong> ${o.id}, <strong>Modelo:</strong> ${o.modelo}, <strong>Status:</strong> ${o.status}<br><strong>Etapas:</strong> <ul>${o.etapas.map(e => `<li>${e.descricao} - ${e.status}</li>`).join('')}</ul>`;
        ul.appendChild(li);
      });
    }

    async function adicionarEtapa() {
      const ordem_id = document.getElementById('etapa_ordem_id').value;
      const descricao = document.getElementById('etapa_descricao').value;
      const status = document.getElementById('etapa_status').value;
      await fetch(`http://localhost:5001/ordens/${ordem_id}/etapas`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ descricao, status })
      });
      listarOrdens();
    }

    async function registrarInspecao() {
      const ordem_id = document.getElementById('ordem_id').value;
      const descricao = document.getElementById('descricao_inspecao').value;
      const conforme = document.getElementById('conforme').checked;
      await fetch('http://localhost:5002/inspecao', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ ordem_id, descricao, conforme })
      });
      listarInspecoes();
    }

    async function listarInspecoes() {
      const resp = await fetch('http://localhost:5002/inspecao');
      const dados = await resp.json();
      const ul = document.getElementById('inspecoes');
      ul.innerHTML = '';
      dados.forEach(i => {
        const li = document.createElement('li');
        li.textContent = `Ordem: ${i.ordem_id}, Desc: ${i.descricao}, Conforme: ${i.conforme}`;
        ul.appendChild(li);
      });
    }

    async function registrarPeca() {
      const codigo = document.getElementById('codigo_peca').value;
      const descricao = document.getElementById('descricao_peca').value;
      const vin = document.getElementById('vin').value;
      await fetch('http://localhost:5003/entrada', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ codigo, descricao, vin })
      });
      listarPecas();
    }

    async function listarPecas() {
      const resp = await fetch('http://localhost:5003/entrada');
      const dados = await resp.json();
      const ul = document.getElementById('pecas');
      ul.innerHTML = '';
      dados.forEach(p => {
        const li = document.createElement('li');
        li.textContent = `Código: ${p.codigo}, Descrição: ${p.descricao}, VIN: ${p.vin}`;
        ul.appendChild(li);
      });
    }

    async function dashboard() {
      const resp = await fetch('http://localhost:5004/dashboard');
      const dados = await resp.json();
      document.getElementById('dashboard').textContent = JSON.stringify(dados, null, 2);
    }

    listarOrdens();
    listarInspecoes();
    listarPecas();
  </script>
</body>
</html>
